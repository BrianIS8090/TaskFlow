# План: Реальное обновление индикации в календаре

## Цель
Сделать так, чтобы индикация (зеленые/оранжевые точки) в календаре обновлялась в реальном времени после каждого действия с задачами: добавление, удаление, завершение задачи, изменение чекпоинтов.

## Текущая проблема
useCalendarStats загружает данные только при изменении года/месяца (через getTasksForMonth). Это статический запрос, не подписан на изменения.

## Решение
Использовать onSnapshot для подписки на все задачи месяца вместо однократной загрузки.

## Фазы

### Фаза 1: Реализация реалтайм-подписки в репозитории
**Чекпоинты:**
- [x] 1.1 Добавить метод `onTasksForMonthChange` в TaskRepository интерфейс (types/index.ts)
- [x] 1.2 Реализовать `onTasksForMonthChange` в FirebaseTaskRepository (firebaseTasks.ts)
- [x] 1.3 Реализовать `onTasksForMonthChange` в MockTaskRepository (mockTasks.ts)
- [x] 1.4 Написать тесты для нового метода (если есть тесты) - тесты не настроены

### Фаза 2: Обновление useCalendarStats
**Чекпоинты:**
- [x] 2.1 Заменить getTasksForMonth на onTasksForMonthChange с useEffect + cleanup
- [x] 2.2 Убедиться что переподписка происходит при смене месяца (dependency array [year, month, repository])
- [x] 2.3 Проверить что нет утечек памяти (cleanup функция возвращает unsubscribe)

### Фаза 3: Интеграция и тестирование
**Чекпоинты:**
- [x] 3.1 Протестировать: добавление задачи → индикатор появился
- [x] 3.2 Протестировать: завершение задачи → индикатор стал зеленым
- [x] 3.3 Протестировать: добавление чекпоинта → индикатор стал оранжевым
- [x] 3.4 Протестировать: завершение чекпоинта → индикатор зеленый
- [x] 3.5 Протестировать: удаление задачи → индикатор пропал
- [x] 3.6 Запустить линтер - ошибок от нового кода нет

## Связи между чекпоинтами
- 1.1 → 1.2, 1.3 (интерфейс нужен перед реализацией)
- 1.2, 1.3 → 2.1 (реализации нужны для хука)
- 2.1 → 3.1-3.6 (хук нужен для тестирования)

## Параллельное выполнение
- 1.2 и 1.3 можно делать параллельно (Firebase и Mock независимы)
- 3.1-3.5 можно проверять последовательно
